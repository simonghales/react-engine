{"version":3,"file":"babel-plugin-react-engine.cjs.production.min.js","sources":["../src/index.ts"],"sourcesContent":["/**\n * This adds {fileName, lineNumber, columnNumber} annotations to JSX tags.\n *\n * NOTE: lineNumber and columnNumber are both 1-based.\n *\n * == JSX Literals ==\n *\n * <sometag />\n *\n * becomes:\n *\n * var __jsxFileName = 'this/file.js';\n * <sometag __source={{fileName: __jsxFileName, lineNumber: 10, columnNumber: 1}}/>\n */\nimport { declare } from \"@babel/helper-plugin-utils\";\nimport * as t from '@babel/types'\nimport jsx from '@babel/plugin-syntax-jsx'\n\nconst TRACE_ID = \"__customSource\";\nconst FILE_NAME_VAR = \"_customJsxFileName\";\n\nconst VALID_COMPONENT_NAMES = ['Editable']\n\nexport default declare(api => {\n  api.assertVersion(7);\n\n  function makeTrace(fileNameIdentifier, lineNumber, column0Based) {\n    const fileLineLiteral =\n        lineNumber != null ? t.numericLiteral(lineNumber) : t.nullLiteral();\n    const fileColumnLiteral =\n        column0Based != null\n            ? t.numericLiteral(column0Based + 1)\n            : t.nullLiteral();\n    const fileNameProperty = t.objectProperty(\n        t.identifier(\"fileName\"),\n        fileNameIdentifier,\n    );\n    const lineNumberProperty = t.objectProperty(\n        t.identifier(\"lineNumber\"),\n        fileLineLiteral,\n    );\n    const columnNumberProperty = t.objectProperty(\n        t.identifier(\"columnNumber\"),\n        fileColumnLiteral,\n    );\n    return t.objectExpression([\n      fileNameProperty,\n      lineNumberProperty,\n      columnNumberProperty,\n    ]);\n  }\n\n  const visitor = {\n    JSXOpeningElement(path, state) {\n      const id = t.jsxIdentifier(TRACE_ID);\n      const location = path.container.openingElement.loc;\n      if (!location) {\n        // the element was generated and doesn't have location information\n        return;\n      }\n\n      if (!VALID_COMPONENT_NAMES.includes(path.node.name.name)) {\n        return;\n      }\n\n      const attributes = path.container.openingElement.attributes;\n      for (let i = 0; i < attributes.length; i++) {\n        const name = attributes[i].name;\n        if (name?.name === TRACE_ID) {\n          // The __source attribute already exists\n          return;\n        }\n      }\n\n      if (!state.fileNameIdentifier) {\n        const fileName = state.filename || \"\";\n\n        const fileNameIdentifier = path.scope.generateUidIdentifier(\n            FILE_NAME_VAR,\n        );\n        const scope = path.hub.getScope();\n        if (scope) {\n          scope.push({\n            id: fileNameIdentifier,\n            init: t.stringLiteral(fileName),\n          });\n        }\n        state.fileNameIdentifier = fileNameIdentifier;\n      }\n\n      const trace = makeTrace(\n          state.fileNameIdentifier,\n          location.start.line,\n          location.start.column,\n      );\n      attributes.push(t.jsxAttribute(id, t.jsxExpressionContainer(trace)));\n    },\n  };\n\n  return {\n    name: \"babel-plugin-react-engine\",\n    inherits: jsx,\n    visitor,\n  };\n});"],"names":["VALID_COMPONENT_NAMES","declare","api","assertVersion","name","inherits","jsx","visitor","JSXOpeningElement","path","state","id","t","location","container","openingElement","loc","includes","node","attributes","i","length","fileNameIdentifier","fileName","filename","scope","generateUidIdentifier","hub","getScope","push","init","trace","lineNumber","column0Based","fileLineLiteral","fileColumnLiteral","fileNameProperty","lineNumberProperty","columnNumberProperty","makeTrace","start","line","column"],"mappings":"qOAqBMA,EAAwB,CAAC,4BAEhBC,WAAQ,SAAAC,UACrBA,EAAIC,cAAc,GA2EX,CACLC,KAAM,4BACNC,SAAUC,EACVC,QAlDc,CACdC,2BAAkBC,EAAMC,OAChBC,EAAKC,gBApCA,kBAqCLC,EAAWJ,EAAKK,UAAUC,eAAeC,OAC1CH,GAKAb,EAAsBiB,SAASR,EAAKS,KAAKd,KAAKA,eAI7Ce,EAAaV,EAAKK,UAAUC,eAAeI,WACxCC,EAAI,EAAGA,EAAID,EAAWE,OAAQD,IAAK,KACpChB,EAAOe,EAAWC,GAAGhB,QAjDlB,0BAkDLA,SAAAA,EAAMA,iBAMPM,EAAMY,mBAAoB,KACvBC,EAAWb,EAAMc,UAAY,GAE7BF,EAAqBb,EAAKgB,MAAMC,sBA1DxB,sBA6DRD,EAAQhB,EAAKkB,IAAIC,WACnBH,GACFA,EAAMI,KAAK,CACTlB,GAAIW,EACJQ,KAAMlB,gBAAgBW,KAG1Bb,EAAMY,mBAAqBA,MAGvBS,WAhEST,EAAoBU,EAAYC,OAC3CC,EACY,MAAdF,EAAqBpB,iBAAiBoB,GAAcpB,gBAClDuB,EACc,MAAhBF,EACMrB,iBAAiBqB,EAAe,GAChCrB,gBACJwB,EAAmBxB,iBACrBA,aAAa,YACbU,GAEEe,EAAqBzB,iBACvBA,aAAa,cACbsB,GAEEI,EAAuB1B,iBACzBA,aAAa,gBACbuB,UAEGvB,mBAAmB,CACxBwB,EACAC,EACAC,IA0CcC,CACV7B,EAAMY,mBACNT,EAAS2B,MAAMC,KACf5B,EAAS2B,MAAME,QAEnBvB,EAAWU,KAAKjB,eAAeD,EAAIC,yBAAyBmB"}