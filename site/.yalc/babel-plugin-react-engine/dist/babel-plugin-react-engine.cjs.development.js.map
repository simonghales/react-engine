{"version":3,"file":"babel-plugin-react-engine.cjs.development.js","sources":["../src/index.ts"],"sourcesContent":["/**\n * This adds {fileName, lineNumber, columnNumber} annotations to JSX tags.\n *\n * NOTE: lineNumber and columnNumber are both 1-based.\n *\n * == JSX Literals ==\n *\n * <sometag />\n *\n * becomes:\n *\n * var __jsxFileName = 'this/file.js';\n * <sometag __source={{fileName: __jsxFileName, lineNumber: 10, columnNumber: 1}}/>\n */\nimport { declare } from \"@babel/helper-plugin-utils\";\nimport * as t from '@babel/types'\nimport jsx from '@babel/plugin-syntax-jsx'\n\nconst TRACE_ID = \"__customSource\";\nconst FILE_NAME_VAR = \"_customJsxFileName\";\n\nconst VALID_COMPONENT_NAMES = ['Editable']\n\nexport default declare(api => {\n  api.assertVersion(7);\n\n  function makeTrace(fileNameIdentifier, lineNumber, column0Based) {\n    const fileLineLiteral =\n        lineNumber != null ? t.numericLiteral(lineNumber) : t.nullLiteral();\n    const fileColumnLiteral =\n        column0Based != null\n            ? t.numericLiteral(column0Based + 1)\n            : t.nullLiteral();\n    const fileNameProperty = t.objectProperty(\n        t.identifier(\"fileName\"),\n        fileNameIdentifier,\n    );\n    const lineNumberProperty = t.objectProperty(\n        t.identifier(\"lineNumber\"),\n        fileLineLiteral,\n    );\n    const columnNumberProperty = t.objectProperty(\n        t.identifier(\"columnNumber\"),\n        fileColumnLiteral,\n    );\n    return t.objectExpression([\n      fileNameProperty,\n      lineNumberProperty,\n      columnNumberProperty,\n    ]);\n  }\n\n  const visitor = {\n    JSXOpeningElement(path, state) {\n      const id = t.jsxIdentifier(TRACE_ID);\n      const location = path.container.openingElement.loc;\n      if (!location) {\n        // the element was generated and doesn't have location information\n        return;\n      }\n\n      if (!VALID_COMPONENT_NAMES.includes(path.node.name.name)) {\n        return;\n      }\n\n      const attributes = path.container.openingElement.attributes;\n      for (let i = 0; i < attributes.length; i++) {\n        const name = attributes[i].name;\n        if (name?.name === TRACE_ID) {\n          // The __source attribute already exists\n          return;\n        }\n      }\n\n      if (!state.fileNameIdentifier) {\n        const fileName = state.filename || \"\";\n\n        const fileNameIdentifier = path.scope.generateUidIdentifier(\n            FILE_NAME_VAR,\n        );\n        const scope = path.hub.getScope();\n        if (scope) {\n          scope.push({\n            id: fileNameIdentifier,\n            init: t.stringLiteral(fileName),\n          });\n        }\n        state.fileNameIdentifier = fileNameIdentifier;\n      }\n\n      const trace = makeTrace(\n          state.fileNameIdentifier,\n          location.start.line,\n          location.start.column,\n      );\n      attributes.push(t.jsxAttribute(id, t.jsxExpressionContainer(trace)));\n    },\n  };\n\n  return {\n    name: \"babel-plugin-react-engine\",\n    inherits: jsx,\n    visitor,\n  };\n});"],"names":["TRACE_ID","FILE_NAME_VAR","VALID_COMPONENT_NAMES","declare","api","assertVersion","makeTrace","fileNameIdentifier","lineNumber","column0Based","fileLineLiteral","t","fileColumnLiteral","fileNameProperty","lineNumberProperty","columnNumberProperty","visitor","JSXOpeningElement","path","state","id","location","container","openingElement","loc","includes","node","name","attributes","i","length","fileName","filename","scope","generateUidIdentifier","hub","getScope","push","init","trace","start","line","column","inherits","jsx"],"mappings":"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"}